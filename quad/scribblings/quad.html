<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"/><title>Quad: document processor</title><link rel="stylesheet" type="text/css" href="scribble.css" title="default"/><link rel="stylesheet" type="text/css" href="racket.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-style.css" title="default"/><link rel="stylesheet" type="text/css" href="manual-racket.css" title="default"/><script type="text/javascript" src="scribble-common.js"></script><script type="text/javascript" src="manual-racket.js"></script><!--[if IE 6]><style type="text/css">.SIEHidden { overflow: hidden; }</style><![endif]--></head><body id="scribble-racket-lang-org"><div class="tocset"><div class="tocview"><div class="tocviewlist tocviewlisttopspace"><div class="tocviewtitle"><table cellspacing="0" cellpadding="0"><tr><td style="width: 1em;"><a href="javascript:void(0);" title="Expand/Collapse" class="tocviewtoggle" onclick="TocviewToggle(this,&quot;tocview_0&quot;);">&#9658;</a></td><td></td><td><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html" class="tocviewselflink" data-pltdoc="x">Quad:<span class="mywbr"> &nbsp;</span> document processor</a></td></tr></table></div><div class="tocviewsublistonly" style="display: none;" id="tocview_0"><table cellspacing="0" cellpadding="0"><tr><td align="right">1&nbsp;</td><td><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html#%28part._.Installing_.Quad%29" class="tocviewlink" data-pltdoc="x">Installing Quad</a></td></tr><tr><td align="right">2&nbsp;</td><td><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html#%28part._.Why_care_about_document_processors_%29" class="tocviewlink" data-pltdoc="x">Why care about document processors?</a></td></tr><tr><td align="right">3&nbsp;</td><td><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html#%28part._.What_does_.Quad_do_%29" class="tocviewlink" data-pltdoc="x">What does Quad do?</a></td></tr><tr><td align="right">4&nbsp;</td><td><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html#%28part._.What_doesn_t_.Quad_do_%29" class="tocviewlink" data-pltdoc="x">What doesn&rsquo;t Quad do?</a></td></tr><tr><td align="right">5&nbsp;</td><td><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html#%28part._.Theory_of_operation%29" class="tocviewlink" data-pltdoc="x">Theory of operation</a></td></tr><tr><td align="right">6&nbsp;</td><td><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html#%28part._.The_markup_language%29" class="tocviewlink" data-pltdoc="x">The markup language</a></td></tr><tr><td align="right">7&nbsp;</td><td><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html#%28part._.The_layout_engine%29" class="tocviewlink" data-pltdoc="x">The layout engine</a></td></tr><tr><td align="right">8&nbsp;</td><td><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html#%28part._.The_rendering_engine%29" class="tocviewlink" data-pltdoc="x">The rendering engine</a></td></tr><tr><td align="right">9&nbsp;</td><td><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html#%28part._.Bottlenecks__roadblocks__irritations%29" class="tocviewlink" data-pltdoc="x">Bottlenecks, roadblocks, irritations</a></td></tr><tr><td align="right">10&nbsp;</td><td><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html#%28part._.Why_is_it_called_.Quad_%29" class="tocviewlink" data-pltdoc="x">Why is it called Quad?</a></td></tr></table></div></div></div><div class="tocsub"><table class="tocsublist" cellspacing="0"><tr><td><span class="tocsublinknumber"></span><a href="#%28part._.Quad__document_processor%29" class="tocsubseclink" data-pltdoc="x">Quad:<span class="mywbr"> &nbsp;</span> document processor</a></td></tr><tr><td><span class="tocsublinknumber">1<tt>&nbsp;</tt></span><a href="#%28part._.Installing_.Quad%29" class="tocsubseclink" data-pltdoc="x">Installing Quad</a></td></tr><tr><td><span class="tocsublinknumber">2<tt>&nbsp;</tt></span><a href="#%28part._.Why_care_about_document_processors_%29" class="tocsubseclink" data-pltdoc="x">Why care about document processors?</a></td></tr><tr><td><span class="tocsublinknumber">2.1<tt>&nbsp;</tt></span><a href="#%28part._.Why_not_keep_using_.La.Te.X_%29" class="tocsubseclink" data-pltdoc="x">Why not keep using La<span class="mywbr"> &nbsp;</span>Te<span class="mywbr"> &nbsp;</span>X?</a></td></tr><tr><td><span class="tocsublinknumber">2.2<tt>&nbsp;</tt></span><a href="#%28part._.Why_not_use_more_.H.T.M.L_.C.S.S_%29" class="tocsubseclink" data-pltdoc="x">Why not use more HTML/<span class="mywbr"> &nbsp;</span>CSS?</a></td></tr><tr><td><span class="tocsublinknumber">3<tt>&nbsp;</tt></span><a href="#%28part._.What_does_.Quad_do_%29" class="tocsubseclink" data-pltdoc="x">What does Quad do?</a></td></tr><tr><td><span class="tocsublinknumber">4<tt>&nbsp;</tt></span><a href="#%28part._.What_doesn_t_.Quad_do_%29" class="tocsubseclink" data-pltdoc="x">What doesn&rsquo;t Quad do?</a></td></tr><tr><td><span class="tocsublinknumber">5<tt>&nbsp;</tt></span><a href="#%28part._.Theory_of_operation%29" class="tocsubseclink" data-pltdoc="x">Theory of operation</a></td></tr><tr><td><span class="tocsublinknumber">6<tt>&nbsp;</tt></span><a href="#%28part._.The_markup_language%29" class="tocsubseclink" data-pltdoc="x">The markup language</a></td></tr><tr><td><span class="tocsublinknumber">7<tt>&nbsp;</tt></span><a href="#%28part._.The_layout_engine%29" class="tocsubseclink" data-pltdoc="x">The layout engine</a></td></tr><tr><td><span class="tocsublinknumber">8<tt>&nbsp;</tt></span><a href="#%28part._.The_rendering_engine%29" class="tocsubseclink" data-pltdoc="x">The rendering engine</a></td></tr><tr><td><span class="tocsublinknumber">9<tt>&nbsp;</tt></span><a href="#%28part._.Bottlenecks__roadblocks__irritations%29" class="tocsubseclink" data-pltdoc="x">Bottlenecks, roadblocks, irritations</a></td></tr><tr><td><span class="tocsublinknumber">10<tt>&nbsp;</tt></span><a href="#%28part._.Why_is_it_called_.Quad_%29" class="tocsubseclink" data-pltdoc="x">Why is it called Quad?</a></td></tr></table></div></div><div class="maincolumn"><div class="main"><div class="versionbox"><span class="versionNoNav">6.4.0.7</span></div><h2><a name="(part._.Quad__document_processor)"></a><a name="(mod-path._quad)"></a>Quad: document processor</h2><div class="SAuthorListBox"><span class="SAuthorList"><p class="author">Matthew Butterick &lt;<a href="mailto:mb@mbtype.com">mb@mbtype.com</a>&gt;</p></span></div><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><span class="RktPn">(</span><span class="RktSym"><span class="badlink"><span class="RktValLink">require</span></span></span><span class="stt"> </span><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html#%28mod-path._quad%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">quad</span></a><span class="RktPn">)</span></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <span class="stt">quad</span></span></td></tr></table></p><p><span style="font-style: italic">This documentation explains software that is under development. It is therefore rife with optimistic claims and wishful thinking.</span></p><h3>1<tt>&nbsp;</tt><a name="(part._.Installing_.Quad)"></a>Installing Quad</h3><p><div class="SIntrapara">At the command line:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0"><tr><td><p><span class="stt">raco pkg install quad</span></p></td></tr></table></div></p><p><div class="SIntrapara">After that, you can update the package like so:
</div><div class="SIntrapara"><table cellspacing="0" cellpadding="0"><tr><td><p><span class="stt">raco pkg update quad</span></p></td></tr></table></div></p><p>Quad is not usable software. It is currently in &ldquo;documented demo&rdquo; mode. There is no need to submit issues or bug reports. Fiddle with it at your own risk.</p><h3>2<tt>&nbsp;</tt><a name="(part._.Why_care_about_document_processors_)"></a>Why care about document processors?</h3><p>A document processor is a rule-driven typesetter. It takes a text-based source file as input and converts it into a page layout.</p><p>For instance, LaTeX is a document processor. So are web browsers. Quad borrows from both traditions &#8212;&#160;it&rsquo;s an attempt to modernize the good ideas in LaTeX, and generalize the good ideas in web browsers.</p><p>Document processors sit opposite WYSIWYG tools like Word and InDesign. There, the user controls the layout by manipulating a representation of the page on the screen. This is fine as far as it goes. But changes to the layout &#8212;&#160;for instance, a new page size &#8212;&#160;often require a new round of manual adjustments.</p><p>A document processor, by contrast, relies on markup codes within the text to determine the layout programmatically. Compared to WYSIWYG, this approach offers less granular control. But it also creates a more flexible relationship between the source and its possible layouts.</p><p>Another benefit of document processors is that it permits every document to have a high-level, text-based source file that&rsquo;s independent of any particular output format (rather than the opaque binary formats endemic to Word, InDesign, et al.)</p><h4>2.1<tt>&nbsp;</tt><a name="(part._.Why_not_keep_using_.La.Te.X_)"></a>Why not keep using LaTeX?</h4><p>I wouldn&rsquo;t want to criticize software merely for being old. It&rsquo;s a great compliment to LaTeX that it&rsquo;s endured this long. But 1) it&rsquo;s never made much headway beyond its original audience of scientific &amp; technical writers; 2) the last 25 years of advances in digital typesetting have been implemented as a huge (occasionally tenuous) tower of patches; 3) the core codebase is increasingly opaque to today&rsquo;s programmers. Meaning, if LaTeX were plausibly rewritable, it would&rsquo;ve been rewritten by now.</p><p>Instead, let&rsquo;s take its good ideas &#8212;&#160;there are many &#8212; and terraform a new planet.</p><h4>2.2<tt>&nbsp;</tt><a name="(part._.Why_not_use_more_.H.T.M.L_.C.S.S_)"></a>Why not use more HTML/CSS?</h4><p>In principle, it&rsquo;s possible to generate PDF documents from a web browser. Support for paper-based layouts has been part of the CSS concept <a href="https://www.w3.org/People/howcome/p/cascade.html">since the beginning</a> (though it&rsquo;s been lightly used).</p><p>But web browsers have a few limitations. First, web browsers only render HTML, and many typesetting concepts (e.g., footnotes) don&rsquo;t correspond to any HTML entity. So there is a narrowing of possiblities. Second, browsers are built for speed, so high-quality typesetting (e.g., the Knuth&#8211;Plass linebreaking algorithm) is off the table. Third, browsers are  inconsistent in how they render pages. Fourth &#8212; taking off my typography-snob tiara here &#8212; browsers are unstable. What seems well supported today can be broken or removed tomorrow. So browsers can&rsquo;t be a part of a dependable publishing workflow that yields reproducible results.</p><h3>3<tt>&nbsp;</tt><a name="(part._.What_does_.Quad_do_)"></a>What does Quad do?</h3><p>Quad produces finished document layouts using three ingredients:</p><ol><li><p>A <span style="font-weight: bold">markup-based language</span> for embedding high-level typsetting instructions in a text document. (Sort of like XML/HTML.)</p></li><li><p>A <span style="font-weight: bold">layout engine</span> that converts these typesetting instructions into an output-independent layout &#8212;&#160;e.g., putting characters into lines, and lines into pages.</p></li><li><p>A <span style="font-weight: bold">rendering engine</span> that takes this layout and prepares it for a particular output format (e.g., PDF, SVG).</p></li></ol><p>While there&rsquo;s no reason Quad couldn&rsquo;t produce an HTML layout, that&rsquo;s an easier problem, because most of the document-layout chores can (and should) be delegated to the web browser. For now, most of Quad&rsquo;s apparatus is devoted to its layout engine so it can produce layouts for PDF.</p><h3>4<tt>&nbsp;</tt><a name="(part._.What_doesn_t_.Quad_do_)"></a>What doesn&rsquo;t Quad do?</h3><p><div class="SIntrapara"><ol><li><p>Quad is not a WYSIWYG or interactive previewing tool.</p></li><li><p>Quad does not have user-level representations of formatting, &#224; la Word style sheets.</p></li><li><p>Quad does not handle semantic or configurable markup. Its markup is limited to its specific, layout-based vocabulary.</p></li></ol></div><div class="SIntrapara">Rather, it is designed to cooperate with tools that offer these facilities.</div></p><h3>5<tt>&nbsp;</tt><a name="(part._.Theory_of_operation)"></a>Theory of operation</h3><p>A document processor starts with input that we can think of as one giant line of text. It breaks this into smaller lines, and then distributes these lines across pages. Conceptually, it&rsquo;s a bin-packing problem.</p><ol><li><p>Quad starts with an input file written in the <font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="RktMeta"></span><span class="hspace">&nbsp;</span><span class="RktMeta"></span><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html#%28mod-path._quad%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">quad</span></a><span class="RktMeta"></span> markup language. For the most part, it&rsquo;s text with markup codes (though it may also include things like diagrams and images).</p></li><li><p>Each markup entity is called a <span style="font-style: italic">quad</span>. A quad roughly corresponds to a box. &ldquo;Roughly&rdquo; because quads can have zero or negative dimension. Also, at the input stage, the contents of some quads may end up being spread across multiple non-overlapping boxes (e.g., a quad containing a word might be hyphenated to appear on two lines). The more precise description of a quad is therefore &ldquo;contiguous markup region.&rdquo; Quads can be recursively nested inside other quads, thus the input file is tree-shaped.</p></li><li><p>This tree-shaped input file is flattened into a list of atomic  quads. &ldquo;Atomic&rdquo; because these are the smallest items the typesetter can manipulate. (For instance, the word <span style="font-style: italic">bar</span> would become three one-character quads. An image or other indivisible box would remain as is.) During the flattening, tags from higher in the tree are propagated downward by copying them into the atomic quads. The result is a &ldquo;stateless&rdquo; representation of the input, in the sense that all the information needed to typeset an atomic quad is contained within the quad itself.</p></li><li><p>Atomic quads are composed into lines using one of three algorithms. (A line is just a quad of a certain width.) The first-fit algorithm puts as many quads onto a line as it can before moving on to the next. The best-fit algorithm minimizes the total looseness of all the lines in a paragraph (aka the Knuth&#8211;Plass linebreaking algorithm developed for TeX). Because best-fit is more expensive, Quad also has an adaptive-fit algorithm that uses a statistical heuristic to guess whether the paragraph will benefit from best-fit; if not, it uses first-fit.</p></li><li><p>If a typeset paragraph still exceeds certain looseness tolerances, it is hyphenated and the lines recalculated.</p></li><li><p>Once the lines are broken, extra space is distributed within each line according to whether the line should appear centered, left-aligned, justified, etc. The result is a list of quads that fills the full column width.</p></li><li><p>Lines are composed into columns. (A column is just a quad of a certain height.) To support things like footnotes, columns are composed using a backtracking constraint-satisfaction algorithm.</p></li><li><p>Columns are composed into pages.</p></li><li><p>This completes the typesetting phase. Note that at every step in the process, the document is represented in the Quad markup language. There isn&rsquo;t a distinction between the public and private markup interface, or the high- and low-level markup entities. Thus, external tools that generate Quad markup have some latitude.</p></li><li><p>Before the typeset markup is passed to the renderer, it goes through a simplification phase &#8212;&#160;a lot of adjacent quads will have the same formatting characteristics, and these can be consolidated into runs of text.</p></li><li><p>The renderer walks through the markup and draws each quad, using information in the markup attributes to determine position, color, font size &amp; style, etc.</p></li></ol><h3>6<tt>&nbsp;</tt><a name="(part._.The_markup_language)"></a><a name="(mod-path._quad)"></a>The markup language</h3><p><table cellspacing="0" cellpadding="0" class="defmodule"><tr><td align="left"><span class="hspace">&nbsp;</span><font class="badlink"><span class="RktModLink"><span class="RktMod">#lang</span></span></font><span class="hspace">&nbsp;</span><a href="file:///Users/mb/git/quad/quad/scribblings/quad.html#%28mod-path._quad%29" class="RktModLink" data-pltdoc="x"><span class="RktSym">quad</span></a></td><td align="right"><span class="RpackageSpec"><span class="Smaller">&nbsp;package:</span> <span class="stt">quad</span></span></td></tr></table></p><p>Quad&rsquo;s markup language is a Racket-implemented DSL (= domain-specific language). It&rsquo;s not a language in the sense of Turing-complete. Rather, a Quad &ldquo;program&rdquo; resembles text annotated with high-level layout-description commands (not unlike XML/HTML).</p><p>Quad programs can be written directly, or generated as the output of other programs.</p><h3>7<tt>&nbsp;</tt><a name="(part._.The_layout_engine)"></a>The layout engine</h3><h3>8<tt>&nbsp;</tt><a name="(part._.The_rendering_engine)"></a>The rendering engine</h3><h3>9<tt>&nbsp;</tt><a name="(part._.Bottlenecks__roadblocks__irritations)"></a>Bottlenecks, roadblocks, irritations</h3><h3>10<tt>&nbsp;</tt><a name="(part._.Why_is_it_called_.Quad_)"></a>Why is it called Quad?</h3><p>In letterpress printing, a <span style="font-style: italic">quad</span> was a piece of metal used as spacing material within a line.</p></div></div><div id="contextindicator">&nbsp;</div></body></html>